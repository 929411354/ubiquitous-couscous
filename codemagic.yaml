# iOSé¡¹ç›®ä¸“ç”¨é…ç½®æ–‡ä»¶
workflows:
  ios-production:
    name: iOS Production Build
    environment:
      # âœ… å…³é”®ä¿®å¤ï¼šæ˜¾å¼å£°æ˜é¡¹ç›®ç±»å‹
      project_type: ios
      
      # âš™ï¸ Xcodeé…ç½®
      xcode: latest
      cocoapods: default
      node: 18.0.0
      
      # ğŸ”  ä¸­æ–‡è·¯å¾„å¼ºåˆ¶ä¿®å¤
      vars:
        LANG: "en_US.UTF-8"
        LC_ALL: "en_US.UTF-8"
    
    # ğŸ“ ç²¾ç¡®é¡¹ç›®è·¯å¾„é…ç½®
    ios:
      project: "ios/Runner.xcodeproj"  # ğŸš¨ æ›¿æ¢ä¸ºå®é™…é¡¹ç›®è·¯å¾„
      scheme: "Runner"                 # ğŸš¨ æ›¿æ¢ä¸ºå®é™…schemeå
    
    scripts:
      # ğŸ“š ä¾èµ–å®‰è£…
      - cd ios
      - pod install
      
      # ğŸ”¨ ç­¾åä¸æ„å»º
      - xcodebuild build -project Runner.xcodeproj -scheme Runner -sdk iphoneos
      - xcodebuild archive -project Runner.xcodeproj -scheme Runner -archivePath build/Runner.xcarchive
      - xcodebuild -exportArchive -archivePath build/Runner.xcarchive -exportOptionsPlist ExportOptions.plist -exportPath build
    
    # ğŸ“¦ ç”ŸæˆIPAæ–‡ä»¶
    artifacts:
      - build/*.ipa
      
    # ğŸ“² å‘å¸ƒåˆ°App Store Connect
    publishing:
      app_store_connect:
        api_key: $APP_STORE_CONNECT_API_KEY
        apple_id: $APPLE_DEVELOPER_ACCOUNT